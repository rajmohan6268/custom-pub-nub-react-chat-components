{"code":"import { __awaiter, __generator } from \"tslib\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { usePubNub } from \"pubnub-react\";\r\nimport cloneDeep from \"lodash.clonedeep\";\r\nexport var usePresence = function (options) {\r\n    if (options === void 0) { options = {}; }\r\n    var jsonOptions = JSON.stringify(options);\r\n    var pubnub = usePubNub();\r\n    var _a = useState({}), presence = _a[0], setPresence = _a[1];\r\n    var _b = useState(), error = _b[0], setError = _b[1];\r\n    var _c = useState(true), doFetch = _c[0], setDoFetch = _c[1];\r\n    var presenceValues = Object.values(presence);\r\n    var total = presenceValues.map(function (ch) { return ch.occupancy; }).reduce(function (prev, cur) { return prev + cur; }, 0);\r\n    var resetHook = function () {\r\n        setPresence({});\r\n        setError(undefined);\r\n        setDoFetch(true);\r\n    };\r\n    useEffect(function () {\r\n        resetHook();\r\n    }, [jsonOptions]);\r\n    useEffect(function () {\r\n        var ignoreRequest = false;\r\n        if (doFetch)\r\n            fetch();\r\n        function fetch() {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var response, e_1;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            _a.trys.push([0, 2, , 3]);\r\n                            return [4 /*yield*/, pubnub.hereNow(JSON.parse(jsonOptions))];\r\n                        case 1:\r\n                            response = _a.sent();\r\n                            if (ignoreRequest)\r\n                                return [2 /*return*/];\r\n                            setDoFetch(false);\r\n                            setPresence(response.channels);\r\n                            return [3 /*break*/, 3];\r\n                        case 2:\r\n                            e_1 = _a.sent();\r\n                            setDoFetch(false);\r\n                            setError(e_1);\r\n                            return [3 /*break*/, 3];\r\n                        case 3: return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        }\r\n        return function () {\r\n            ignoreRequest = true;\r\n        };\r\n    }, [pubnub, doFetch, jsonOptions]);\r\n    useEffect(function () {\r\n        var listener = {\r\n            presence: function (event) {\r\n                setPresence(function (presence) {\r\n                    var presenceClone = cloneDeep(presence);\r\n                    if (!presenceClone[event.channel])\r\n                        presenceClone[event.channel] = { name: event.channel, occupancy: 0, occupants: [] };\r\n                    var channel = presenceClone[event.channel];\r\n                    if (event.action === \"join\") {\r\n                        if (!channel.hasOwnProperty(\"occupants\"))\r\n                            channel.occupants = [];\r\n                        channel.occupancy = event.occupancy;\r\n                        if (options.includeUUIDs !== false &&\r\n                            channel.hasOwnProperty(\"occupants\") &&\r\n                            !channel.occupants.find(function (u) { return u.uuid == event.uuid; })) {\r\n                            var state = event.state, uuid = event.uuid;\r\n                            channel.occupants.push({ state: state, uuid: uuid });\r\n                        }\r\n                    }\r\n                    if ([\"leave\", \"timeout\"].includes(event.action)) {\r\n                        channel.occupancy = event.occupancy;\r\n                        if (options.includeUUIDs !== false &&\r\n                            channel.hasOwnProperty(\"occupants\") &&\r\n                            channel.occupants.find(function (u) { return u.uuid == event.uuid; })) {\r\n                            presenceClone[event.channel].occupants = channel.occupants.filter(function (u) { return u.uuid !== event.uuid; });\r\n                        }\r\n                    }\r\n                    return presenceClone;\r\n                });\r\n            },\r\n        };\r\n        pubnub.addListener(listener);\r\n        return function () {\r\n            pubnub.removeListener(listener);\r\n        };\r\n    }, [pubnub, options.includeUUIDs]);\r\n    return [presence, resetHook, total, error];\r\n};\r\n//# sourceMappingURL=use-presence.js.map","references":["/Users/rajmohan/Desktop/edvoy/rnd/react-chat-components/node_modules/@types/react/index.d.ts","/Users/rajmohan/Desktop/edvoy/rnd/react-chat-components/node_modules/@types/pubnub/index.d.ts","/Users/rajmohan/Desktop/edvoy/rnd/react-chat-components/node_modules/pubnub-react/dist/index.d.ts","/Users/rajmohan/Desktop/edvoy/rnd/react-chat-components/node_modules/lodash.clonedeep/index.js"],"map":"{\"version\":3,\"file\":\"use-presence.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/hooks/use-presence.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/rajmohan/Desktop/edvoy/rnd/react-chat-components/lib/node_modules/.cache/rollup-plugin-typescript2/placeholder/hooks/use-presence.d.ts","writeByteOrderMark":false,"text":"import { HereNowParameters, HereNowResponse } from \"pubnub\";\r\ndeclare type ChannelsOccupancy = HereNowResponse[\"channels\"];\r\ndeclare type HookReturnValue = [ChannelsOccupancy, () => void, number, Error];\r\nexport declare const usePresence: (options?: HereNowParameters) => HookReturnValue;\r\nexport {};\r\n"}}
