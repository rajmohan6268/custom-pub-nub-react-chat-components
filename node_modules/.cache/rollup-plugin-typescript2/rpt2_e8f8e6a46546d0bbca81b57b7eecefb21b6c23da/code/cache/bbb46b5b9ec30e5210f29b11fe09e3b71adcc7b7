{"code":"import { __awaiter, __generator, __spreadArray } from \"tslib\";\r\nimport { useState, useEffect, useMemo } from \"react\";\r\nimport { usePubNub } from \"pubnub-react\";\r\nimport merge from \"lodash.merge\";\r\nimport cloneDeep from \"lodash.clonedeep\";\r\nexport var useUserMemberships = function (options) {\r\n    if (options === void 0) { options = {}; }\r\n    var jsonOptions = JSON.stringify(options);\r\n    var pubnub = usePubNub();\r\n    var _a = useState([]), channels = _a[0], setChannels = _a[1];\r\n    var _b = useState(0), totalCount = _b[0], setTotalCount = _b[1];\r\n    var _c = useState(\"\"), page = _c[0], setPage = _c[1];\r\n    var _d = useState(), error = _d[0], setError = _d[1];\r\n    var _e = useState(true), doFetch = _e[0], setDoFetch = _e[1];\r\n    var paginatedOptions = useMemo(function () {\r\n        return merge({}, JSON.parse(jsonOptions), {\r\n            page: { next: page },\r\n            include: { totalCount: true },\r\n        });\r\n    }, [page, jsonOptions]);\r\n    var fetchMoreMemberships = function () {\r\n        setDoFetch(true);\r\n    };\r\n    var resetHook = function () {\r\n        setChannels([]);\r\n        setTotalCount(0);\r\n        setPage(\"\");\r\n        setError(undefined);\r\n        setDoFetch(true);\r\n    };\r\n    useEffect(function () {\r\n        resetHook();\r\n    }, [jsonOptions]);\r\n    useEffect(function () {\r\n        var ignoreRequest = false;\r\n        if (doFetch)\r\n            fetchPage();\r\n        function fetchPage() {\r\n            return __awaiter(this, void 0, void 0, function () {\r\n                var response_1, e_1;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            _a.trys.push([0, 2, , 3]);\r\n                            if (totalCount && channels.length >= totalCount)\r\n                                return [2 /*return*/];\r\n                            return [4 /*yield*/, pubnub.objects.getMemberships(paginatedOptions)];\r\n                        case 1:\r\n                            response_1 = _a.sent();\r\n                            if (ignoreRequest)\r\n                                return [2 /*return*/];\r\n                            setDoFetch(false);\r\n                            setChannels(function (channels) { return __spreadArray(__spreadArray([], channels, true), response_1.data.map(function (m) { return m.channel; }), true); });\r\n                            setTotalCount(response_1.totalCount);\r\n                            setPage(response_1.next);\r\n                            return [3 /*break*/, 3];\r\n                        case 2:\r\n                            e_1 = _a.sent();\r\n                            setDoFetch(false);\r\n                            setError(e_1);\r\n                            return [3 /*break*/, 3];\r\n                        case 3: return [2 /*return*/];\r\n                    }\r\n                });\r\n            });\r\n        }\r\n        return function () {\r\n            ignoreRequest = true;\r\n        };\r\n    }, [totalCount, pubnub.objects, paginatedOptions, channels.length, doFetch]);\r\n    useEffect(function () {\r\n        var listener = {\r\n            objects: function (event) {\r\n                var message = event.message;\r\n                if (message.type !== \"membership\")\r\n                    return;\r\n                setChannels(function (channels) {\r\n                    var channelsCopy = cloneDeep(channels);\r\n                    var channel = channelsCopy.find(function (u) { return u.id === message.data.channel.id; });\r\n                    var currentUuid = paginatedOptions.uuid || pubnub.getUUID();\r\n                    // Make sure the event is for the same uuid as the hook\r\n                    if (message.data.uuid.id !== currentUuid)\r\n                        return channelsCopy;\r\n                    // Set events are not handled since there are no events fired for data updates\r\n                    // New memberships are not handled in order to conform to filters and pagination\r\n                    if (channel && message.event === \"delete\") {\r\n                        channelsCopy.splice(channelsCopy.indexOf(channel), 1);\r\n                    }\r\n                    return channelsCopy;\r\n                });\r\n            },\r\n        };\r\n        pubnub.addListener(listener);\r\n        return function () {\r\n            pubnub.removeListener(listener);\r\n        };\r\n    }, [pubnub, paginatedOptions.uuid]);\r\n    return [channels, fetchMoreMemberships, resetHook, totalCount, error];\r\n};\r\n//# sourceMappingURL=use-user-memberships.js.map","references":["/Users/rajmohan/Desktop/edvoy/rnd/react-chat-components/node_modules/@types/react/index.d.ts","/Users/rajmohan/Desktop/edvoy/rnd/react-chat-components/node_modules/@types/pubnub/index.d.ts","/Users/rajmohan/Desktop/edvoy/rnd/react-chat-components/node_modules/pubnub-react/dist/index.d.ts","/Users/rajmohan/Desktop/edvoy/rnd/react-chat-components/node_modules/lodash.merge/index.js","/Users/rajmohan/Desktop/edvoy/rnd/react-chat-components/node_modules/lodash.clonedeep/index.js","/Users/rajmohan/Desktop/edvoy/rnd/react-chat-components/lib/src/types.ts"],"map":"{\"version\":3,\"file\":\"use-user-memberships.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/hooks/use-user-memberships.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/rajmohan/Desktop/edvoy/rnd/react-chat-components/lib/node_modules/.cache/rollup-plugin-typescript2/placeholder/hooks/use-user-memberships.d.ts","writeByteOrderMark":false,"text":"import { GetMembershipsParametersv2 } from \"pubnub\";\r\nimport { ChannelEntity } from \"../types\";\r\ndeclare type HookReturnValue = [ChannelEntity[], () => void, () => void, number, Error];\r\nexport declare const useUserMemberships: (options?: GetMembershipsParametersv2) => HookReturnValue;\r\nexport {};\r\n"}}
